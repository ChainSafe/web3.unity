name: Duplicate Package Samples Workflow

on:
  push:
    branches: [ rob/samples-import-fixes-642 ]

jobs:
  duplicate:
    name: Duplicate samples job ðŸ‘¯
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Duplicate Web3 Unity Samples
      run: |
        for i in 1 2
        do
          export SOURCE_PATH="importable_sample_path_$i"
          SOURCE_PATH=${!SOURCE_PATH}
          
          export DESTINATION_DIRECTORY="importable_sample_directory_$i"
          DESTINATION_DIRECTORY=${!DESTINATION_DIRECTORY}
          
          SOURCE_PATH="${GITHUB_WORKSPACE}/$SOURCE_PATH/$(ls $SOURCE_PATH | head -n 1)/$DESTINATION_DIRECTORY"
        
          export DESTINATION_PATH="imported_sample_path_$i"
          DESTINATION_PATH=${!DESTINATION_PATH}
          DESTINATION_PATH="${GITHUB_WORKSPACE}/$DESTINATION_PATH"
          
          rm -rf "$DESTINATION_PATH"
          mkdir -p "$DESTINATION_PATH"
          cp -r "$SOURCE_PATH" "$DESTINATION_PATH"
        done
      env: 
        importable_sample_path_1: "src/UnitySampleProject/Assets/Samples/web3.unity SDK"
        importable_sample_directory_1: "Web3.Unity Samples"
        imported_sample_path_1: "Packages/io.chainsafe.web3-unity/Samples~/Web3.Unity/"
        importable_sample_path_2: "src/UnitySampleProject/Assets/Samples/web3.unity SDK Web3Auth"
        importable_sample_directory_2: "Web3.Unity Web3Auth Samples"
        imported_sample_path_2: "Packages/io.chainsafe.web3-unity.web3auth/Samples~/Web3.Unity Web3Auth/"
    - name: Commit and Push
      run: |
        git config user.email $git_email
        git config user.name "${{ github.actor }}"
        git add ./Packages/io.chainsafe.web3-unity/Samples~/. -f
        git add ./Packages/io.chainsafe.web3-unity.web3auth/Samples~/. -f
        git diff-index --cached --quiet HEAD || git commit -m "Auto-duplicate Packages Samples"
        git push
      env:
        git_email: "${{ github.actor }}@users.noreply.github.com"